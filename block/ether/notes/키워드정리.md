// # 비트코인은 RPC 통신  P2P통신
이더리움은 Wire 통신 P2P통신

노드는 역활이 크게 두가지로 나눠집니다

전체노드와 체굴노드

전체노드 : 대부분 노드는 기본적으로 개러내역을 수동으로 처맇바니다. 블록체인 데이터베이스에서 읽어올 수는 있지만 새로운 블록을 생성할 수는 없ㅅ브니다. 다만 피어 노드에서 받은 블록을 자신의 로컬 블록체인에 추가할 수있습니다. 또 피어 노드로부터 받은 블록체인 블록의 정확성을 검증하기 위해서만 거래를 실행합니다. 투표 앱의 경우 전체 노드(full node)는 동료로 부터 받은 투표내역을 다른 동료에게 전파합니다. 또한 받은 블록이 올바른지 검증하고 투표 디앱 스마트 컨트랙트를 실행하여 투표내역을 포함합니다. 그러나 전체 노드는 새로운 블록에 투표내역을 저장하지않습니다.

채굴노드 : 일부 노드는 거래내역을 적극적으로 처리합니다. 거래내역을 모아서 새로운 블록에 저장합니다. 이더리움 플랫폼에서 지원하는 암호화폐인 이더를 보상 받기 위해 계산량이 많고 에너지가 많이 소요되는 작업을 수행합니다. 그런 다음 생성된 블록을 나머지 P2P 네트워크에 전파합니다. 이러한 노드를 채굴 노드(mining node) 라고 부르며 새로운 블록을 블록체인에 추가하고 암호화폐를 보상으로 받는 과정을 채굴 (mining) 이라고 부릅니다. 투표디앱의 경우 채굴 노드는 피어 노드에서 받은 투표내역을 모아 블록을 생성합니다. 생성된 블록을 블록체인에 추가하고 피어 노드를 통해 블록을 전파합니다.

* 이더리움 네트워크의 주요 노드 형태는 두 가지다. 전체노드(full node)는 거래내역을 수동적으로 처리하고 블록체인을 읽을 수는 있지만 쓸 수는 없다. 채굴 노드는 트랜잭션을 적극적으로 처리한다. 전체 노드가 수행하는 거래의 정확성을 검증하고 거래내역을 모아 새로운 블록을 생성하고 기존 블록체인에 추가한다.

## 종합해서 살펴보기
투표 디앱의 구조를 살펴봤습니다. 클리언트와 서버 측을 포함한 전체 시스템을 보여줍니다.

# 1.1.3 거래 흐름: 거래 수명주기에 따른 관점

정적 구조에서 조금 더 나아가 투표의 전체 수명주기를 단계별로 설명하겠습니다.

1. 사용자가 웹 화면에서 드롭다운 선택 박스로 된 투표 옵션 중 하나를 선택하고 [vote]를 클릭합니다.
2. 자바스크립트 함수가 클릭 이벤트를 처리하고 선택된 투표내역을 가져옵니다. 그런 다음 다양한 web3.js 라이브러리 함수를 사용하여 투표 스마트 컨트랙트와 연결된 이더리움 노드와 연결하고 castVote() 함수를 호출합니다. castVote()는 전자서명된 거래내역 메시지를 생성하여 사용자가 실제로 이것을 보낸 사람임을 증명합니다.
3. 연결된 로컬 이더리움 노드는 거래내역 메시지를 처리하고 검증한 뒤에 피어 노드로 전달합니다.
4. 피어 노드는 거래내역이 채굴 노드를 만날 떄까지 거래내역을 계속 전파합니다. 이는 전체 노드와 채굴 노드의 비율에 따라 다르지만 상대적으로 빠르게 일어납니다. 채굴 노드는 전체 노드의 동일한 단계(2단계 및 3단계)를 수행합니다. 또한 채굴 노드는 투표내역과 같은 거래내역 중 하나를 선택합니다. 거래를 처리하기 위해 필요한 전기 요금보다 많은 거래 수수료를 얻을 것으로 예상되면 해당 거래내역은 수익성이 있다고 판단할 수 있습니다. 그렇다면 채굴 노드는 castVote() 함수를 실행하고 블록체인에 거래내역을 먼저 저아하기 위해 다른 채굴 노드들과 경쟁합니다. 경쟁에서 이긴 채굴노드 (이른바 합의 알고리즘, 암호화 문제를 성공적으로 해결한 채굴자) 는 투표내역을 새로운 블록에 있는 다른 내역과 같이 모읍니다. 그런 다음 생성된 블록을 전체 노드 또는 채굴 노드에 관계없이 모든 피어 노드에 전달합니다.
5. 각 노드는 새로운 블록을 받게 되면 블록에 포함된 개별 거래내역이 정상적이지 또 전체 블록이 유효한지 여부를 검증합니다. 그런 다음 블록에 존재하는 모든 거래내역을 처리합니다. 이 과정에서 계약 상태의 유효성을 암시적으로 확인합니다. 이를테면 투표 제출 로직에는 후보자가 투표할 수있는 횟수나 투표 수가 등록된 유권자 수 보다 크지 않는지 등이 포함됩니다. 노드가 성공적으로 블록을 확인하면 해당 블록을 피어노드로 전달합니다. 전체 네트워크가 새 블록을 추가할 떄가지 피어 노드는 동일한 검증 작업및 전파 작업을 반복합니다(암호화 기술을 기반으로 한 검증 과정은 다음 장에서 더 명확하게 설명하도록 하겠습니다.)
6. 사용자 관점에서 로컬 이더리움 노드는 새로운 블록을 수신하고 다른 노드와 마찬가지로 수신된 블록에 있는 모든 거래내역을 실행하여 검증합니다. 그중 하나가 투표 트랜잭션이며 검증이 성공적으로 완료되면 VoteConfirmation 이벤트를 발생시키도록 프로그래밍 되어있습니다. 이벤트는 디앱 웹 UI를 포함하여 해당 노드와 연결된 모든 클라이언트에 전파됩니다.
7. 투표 웹 클라이언트의 자바스크립트 코드에는 VoteConfirmation 이벤트에 대한 콜백함수가 포함되어 있으며 이 이벤트가 완료되면 콜백함수가 호출됩니다.
8. 마지막으로 콜백함수는 사용자의화면에 투표가 완료되었음을 표시해줍니다. 


[47page 그림 참고]


48page

투표 흐름의 수명주기,투표자 브라우저가 이더리움 네트워크의 로컬 노드에서 투표 스마트 컨트랙트에 있는 castVote() 함수를 호출하면 투표내역이 생성된다. 그런 다음 유효성 검사가 수행되고 채굴노드에 의해 새로운 블록이 블록체인에 포함될 때가지 네트워크 전체에 전파된다. 새로운 블록은 네트워크 전체에 전파된 다음 최종족으로 로컬 노드로 되돌아온다. 

[48page 그림참고]

 

 # 1.1.4 디앱용어

 탈중앙화 앱은 비교적 새로운 개념이지만 처음 디앱이 만들어진 뒤에 곧바로 표준화된 용어가 생기기 시작했습니다. 이 절에는 이더리움을 만든 비탈리크 부테린이 디앱의 주요 개념을 설명하기 위해서 작성한 블로그 게시물에 설명한 핵심 용어를 요약했습니다. 앞에서 이미 용어 중 일부를 알아봤지만. 이번에는 좀 더 정확하게 알아보겠습니다.

 ## 스마트 컨트랙트

 스마트컨트랙트 ( Smart contract ) 는 디지털 자산을 교환하는 둘 이상의 당사자 사이에서 이루어지는 계약입니다. 당사자 중 한 명 또는  그 이상의 디지털 자산을 스마트 컨트랙트에 보냄으로써 그 계약이 활성화됩니다. 그런 다음 디지털 자산은 사전에 정의되고 프로그래밍 된 규칙과 계약이 활성화된 상태에 따라서 다시 다른 사람에게 보내집니다.

 ## 자율개체 

 자율 개체는 외부 소프트웨어 서비스와 자율적으로 상호작용하는 소프트웨어 개체입니다. 외부 환경에서 검증된 변경 사항에 따라 스스로 재구성하고나 심지어 재프로그래밍 할 수 있습니다.

 ## 탈중앙화 조직

 전통적인 중앙화 조직은 자산, 투자자, 직원 및 고객등 다양한 계층의 개인으로 구성되어 있습니다. 투자자는 조직 일부를 주식으로 소유하고 조직을 통제합니다.
 다양한 계층에 있는 개인 간의 상호작용을 조직을 제어할 수있는 권한에 따라 영향을 받습니다. 예를 들어 직원은 투자자 또는 투자자가 직 간접적으로 권한을 부여한 다른 직원을 채용합니다.

 탈중앙화 조직 (DO)은 어느 개인이나 주체에게 통제되지 않습니다. 사전에 정의된 규칙이 조직을 구성하는 다양한 계층에 있는 개인 간의 상호작용을 결정합니다. 
 그러나 이러한 규칙 역시 특정 개인이 다른 사람보다 더 많은 권한을 갖도록 설계 될 수 있습니다.
 예를들어 중앙화 조직처럼 보유한 주식 수에 따라 권한을 부여 할 수 도 있습니다.


 ## 탈중앙화 자율 조직

 탈중앙화 자율조직 (DAO) 은 탈중앙화 조직이면서 자율개체 입니다. 자율 개체와 마찬가지로 외부 소프트웨어 서비스와 자율적으로 상호작용하는 소프트웨어 개체입니다. DAO와 관련된 개인은 미리 정의된 규칙을 바탕으로 DO처럼 상호작용합니다.
 DAO와 DO의 가장 큰 차이는 DAO는 외부 주체 간의 상호작용이 대부분 자동화되어 있고 상호작용 프로토콜이 스마트 컨트랙트로 프로그래밍 되어 있는 반면, DO 및 외부 주체는 수동 프로토콜을 사용한다는 점입니다. 외부 주체자의 관점에서 볼 떄 DAO는 상호작용이 자동화 되어 있어 예측 할 수 있기 때문에 DO보다 더 신뢰할 수 있습니다. 반면 DO는 수동 프로토콜 을 기반으로 수행하는 개인의 평판에 상호작용을 전적으로 의존해야 합니다.

 이러한 정의에 따르면 암호화폐를 지원하기 위한 목적으로 구축된 블록체인 플랫폼은 DAO또는 DO로 분류될 수 있습니다. 비트코인 이프라는 쉽게 자동화된 상호작용 프로토콜을 구현 할 수 없으므로 어떤 사람들은 DO로 분류돼야 한다고 주장합니다.


 ## 탈중앙화 자율 기업

 탈중앙화 자율 기업 (DAC) 은 DAO임녀서 주식을 구매하여 기업의 일부를 소유할 수 있습니다. 전통적인 기업(중앙화된 조직)과 마찬가지로 실적에 따라 주기적으로 배당금을 지불합니다. 반면 DAO는
 일반적으로 비영리 단체입니다. 참여자는 생태계에 기여하고 내부 자본금을 증대시켜 경제적 이익을 독점하여 얻을 수 있습니다.

 - NOTE. 현재 일반적으로 인저되는 탈중앙화 앱의 정의는 이더리움 순수주의자가 이야기하는 DAO의 정의에 부합합니다. 이책에서는 이러한 관점을 디앱의 정의로 삼으려 합니다. 왜냐하면 초기에는 애플리케이션이란 용어보다 기관이라는 단어를 더많이 사용했습니다. 이더리움 창립자들은 탈중앙화 애플리케이션이 다른 주체들과 전통적인 기관처럼 거래할 수있다는 것을 강조하고 싶었습니다. 정해진 규칙과 규약에 따라 금전적인 가치를 당연히 전통적인 화폐가 아닌 암호화폐형태로 교환할 수 있기 떄문입니다.


 .표 1-1 
 ----------------------------------------------------------------------------------------
                소프트웨어인가      자본금이 필요한가       자율적인가      소유할 수 있는가
 ----------------------------------------------------------------------------------------
 자율개체           예                  아니요              예                  아니요
 ----------------------------------------------------------------------------------------
 DO                아니요               예                  아니요              예
 ----------------------------------------------------------------------------------------
 DAO                예                  예                  예                 아니요
 ----------------------------------------------------------------------------------------
 DAC                예                  예                  예                 예
 ----------------------------------------------------------------------------------------


몇가지 개념적인 용어를 알아봤습니다. 하지만 블록체인의 개념에 익숙하지 않은 상태에서는 디앱의 목적과 그것이 어떻게 작동하는지 이해하기는 어렵습니다. 디앱은 블록체인 위에서 구축되고 블록체인 기술에의존도가 높기 떄문에 반드시 기반 기술을 이해해야 합니다. 이 부분은 다음 절에서 다룹니다.

탈중앙화 애플리케이션 vs 분산 애플리케이션

탈줄앙화 애플리케이션을 분산 애플리케이션과 혼동해서는 안됩니다. 비슷한 갠며으로 보이지만 같지 않습니다.
분산 애플리케이션은 하나의 네트워크 내에 있는 여러 서버에서 애플리케이션이 실행됩니다. 분산 애플리케이션의 가장 간단한 예는 웹 애플리케이션입니다. 일반적으로 하나의 웹 애플리케이션은 웹서버 , 
애플리케이션 서버 및 데이터베이스 서버로 구성되고 경우에 따라 전자메일 서버나 기존 메인프레임으로 구성되어 있습니다. 앞서 살펴본 중앙화된 투표 앱이 분산 애플리케이션의 예 입니다.
여러 대의 서버에 기능을 분배하여 분산화되어 있지만 모든 서버는 동일한 기관이 소유하기 때문에 중앙화되어 있습니다.

분산 애플리케이션은 네트워크의 여러 서버에서 실행됩니다. 탈주앙화 애플리케이션은 전체 네트워크의 각 노드에서 전체적으로 복제됩니다.
탈중앙화 애플리케이션은 이론적으로 각자 다른 주체가 소유하고 있는 노드에서 복제되어 실행됩니다. 노드를 소유하는 주체가 많을수록 전체 네트워크를 신뢰도는 올라갑니다. 당연히 소수노드로 운영되는
네트워크는 진정으로 탈중앙화된 처리를 할 수 없기 때문에 신뢰도 역시 떨어집니다.

중앙화 애플리케이션은 일반적으로 분산화 되어 있지만 탈중앙화 앱 역시 하나의 논리 노드 안에서 여러 서버로 분산될 수 있습니다.

# 1.3 5분만에 디앱 구현하기

지금까지 알아본 디앱의 개념과 목적 , 탈중앙화 앱의 주요 아키텍처 구성 요소와 블록체인 기술의 기반으로 하는 프로젝트에 착수하는 것이 과연 합리적인지 잘 이해하고 있어야 합니다.
이제 조금 더 나아가 프로그래밍을 시작하겠습니다. 이 장의 나머지 부분에서는 나만의 암호화폐를 위한 스마트 컨트랙트를 개발하고 이를 활성화하여 사용해보겠습니다.


# 1.3.1 기본적인 암호화폐 심플코인 만들기

대부분 디앱은 하나 또는 하나 이상의 스마트 컨트랙트 안에 코딩된 규칙을 통해 암호화폐 또는 토큰을 교환하는 기능을 기초로 설계됩니다. 기본적인 암호화폐인 심플코인을 통해 디앱 프로그래밍을 경험하고 
스마트 컨트랙트와 이더리움 플랫폼을 이해하는데 필요한 기초 개념을 익혀보겠습니다. 다음 장에서는 디앱 개발에 관해 더욱 자세히 설명하며 조금씩 디앱을 발전시켜 나갈겁니다.

나중에 만들어볼 다른 디앱도 심플코인을 사용하거나 참고할 것입니다.

아직 이더리움 플랫폼 클라이언트를 컴퓨터에서 설치하지 않았기 때문에 지금은 리믹스 솔리디티 ( 이전에는 브라우저 솔리디티) 통합 개발환경  IDE에서 코드를 작성할겁니다.

온라인 개발도구인 리믹스 솔리디티 를 사용하면 자바스크립트와 비슷한 솔리디티라는 고수준 언어로 스마트 컨트랙트를 구현하게 됩니다. 또 다음장에서 만날 이더리움 가상 시스템을 에뮬레이션하는
로컬 자바스크립트 VM에서 실행할 수 있습니다. 리믹스로 이더리움 네트워크에 배포된 실제 스마트 컨트랙트를 활용 할 수도 있습니다.

웹브라우저를 열고 http://remix.ethereum.org/ 로 이동합니다. 웹사이트에서 IDE의 왼쪽은 파일 탐색기입니다. 화면의 왼쪽 상단에 있는 이중 화상표를 클릭하여 숨길 수도 있습니다. 중간에는 코드 편집기가 있고 오른쪽에는 코드 실행하고 설정할수있는 다양한 패널이 있습니다.

솔리디티를 처음 나왔으니 이제 되도록 가장 간단한 스마트 컨트랙트를 구현해 보겠습니다. 스마트 컨트랙트는 객체 지향 언어의 클래스와 비슷합니다. 맴버 필드 하나, 생성자 하나, 매서드 하나만 있는 단일 클래스를 작성한 뒤 그것을 실행하고 사용해볼 것입니다.

리믹스 화면에서 이중 화살표를 클릭하여 파일 탐색기를 숨기고 편집기에서 코드를 입렵합시다.

항상 첫시작은 Hello world!
contracts 폴더안에 생성할겁니다.
Create New file 클릭하여 파일을 생성
```
````


드리즐 (Drizzle) - 리덕스(redux) 라이브러리 블록체인 프론트앤드와 연결합니다 (?)

트러플 (Truffle)